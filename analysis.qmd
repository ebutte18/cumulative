---
title: "Cumulative"
author: "Eric Butte"
format: html
execute: 
  echo: false
---


```{r}
#| message: false
#| warning: false
library(MASS)
library(tidyverse)
library(primer.data)
library(broom)
library(dplyr)
library(easystats)
library(knitr)
library(kableExtra)
library(stringr)
library(marginaleffects)
```

```{r}
#| cache: true
```


```{r}
x <- x <- ces |>
  filter(year == 2020) |>
  select(approval, ideology, education) |>
  drop_na() |> 
  filter(! ideology %in% "Not Sure") |> 
  mutate(ideology = fct_drop(ideology))

fit_approval <- polr(approval ~ ideology + education,
                      data = x)
```


```{r}
x |>
ggplot(aes(x = ideology, fill = approval)) + geom_bar() +
labs(title = "Approval ratings of President Trump in 2020", 
subtitle = "Liberals disapproved and Converservatives approved",
x = "Ideology", y = "Number of persons")
```

$$
\log \left( \frac{\mathbb{P}(Y_i \leq k)}{\mathbb{P}(Y_i > k)} \right)
= \theta_k - \left( \beta_1 X_{1i} + \beta_2 X_{2i} + \cdots + \beta_p X_{pi} \right),
\quad \text{for } k = 1, \dots, K - 1
$$

```{r}
fit_approval |>
    tidy(conf.int = TRUE)
```

$$
\log \left( \frac{\mathbb{P}(\hat{Y}_i \leq k)}{\mathbb{P}(\hat{Y}_i > k)} \right) = \theta_k
- \bigg(
  0.615 \cdot \text{ideology}_{\text{Liberal}, i}
+ 2.401 \cdot \text{ideology}_{\text{Moderate}, i}
+ 4.464 \cdot \text{ideology}_{\text{Conservative}, i}
+ 5.454 \cdot \text{ideology}_{\text{VeryConservative}, i}
- 0.096 \cdot \text{education}_{\text{HighSchoolGrad}, i}
- 0.311 \cdot \text{education}_{\text{SomeCollege}, i}
- 0.325 \cdot \text{education}_{\text{2Year}, i}
- 0.521 \cdot \text{education}_{\text{4Year}, i}
- 0.727 \cdot \text{education}_{\text{PostGrad}, i}
\bigg)
\quad \text{for } k = 1, \dots, 4
$$


```{r}
fit_approval |>
  tidy(conf.int = TRUE) |>
  filter(coef.type == "coefficient") |>  # Only show slope coefficients
  mutate(
    term = stringr::str_replace_all(term, "\\|", " | "),
    Estimate = round(estimate, 3),
    `95% CI` = paste0("[", round(conf.low, 3), ", ", round(conf.high, 3), "]")
  ) |>
  select(Term = term, Estimate, `95% CI`) |>
  kable(format = "latex", booktabs = TRUE, caption = "Cumulative Logit Model Estimates with 95% Confidence Intervals") |>
  kable_styling(latex_options = c("striped", "hold_position", "scale_down")) |>
  row_spec(0, bold = TRUE)
```



Political ideology of a citizen will consistently reflect their approval rating of the president. Using a data source from CES, we can unpack this phenomenon and understand why it is. A weakness is that the survey was conducted in 2020 and many people's poltiical ideologies could have changed since then based on multiple world events like COVID-19 and the ensuing years. We model approval rating as a cumulative function of political ideology and education. People with conservative political ideology will have a higher approval rating for President Trump. 

